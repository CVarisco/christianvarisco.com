---
import '../styles/global.css';
import SEOHead from '../components/seo/SEOHead.astro';
import JsonLd from '../components/seo/JsonLd.astro';
import type { Lang } from '../i18n';
import { getAlternatePath } from '../i18n';

interface CaseStudy {
  company: string;
  website: string;
  heroImage: string;
  seo: { title: string; description: string };
  testimonial?: {
    quote: string;
    author: string;
    role: string;
    rating: number;
  };
}

interface Props {
  lang: Lang;
  seo: {
    title: string;
    description: string;
    ogImage?: string;
  };
  faqItems?: Array<{ question: string; answer: string }>;
  services?: Array<{ title: string; solution: string }>;
  caseStudy?: CaseStudy;
}

const { lang, seo, faqItems, services, caseStudy } = Astro.props;
const currentPath = Astro.url.pathname;
const alternatePaths = getAlternatePath(lang, currentPath);
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <SEOHead
      title={seo.title}
      description={seo.description}
      ogImage={seo.ogImage}
      lang={lang}
      alternatePaths={alternatePaths}
    />

    <JsonLd
      lang={lang}
      faqItems={faqItems}
      services={services}
      caseStudy={caseStudy}
    />

    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://cal.com" />
    <link rel="dns-prefetch" href="https://cal.com" />
    <link rel="preconnect" href="https://www.youtube.com" />
    <link rel="dns-prefetch" href="https://www.youtube.com" />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  </head>
  <body>
    <slot />

    <!-- Scroll Reveal Animation Script -->
    <script>
      const initScrollReveal = () => {
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
                observer.unobserve(entry.target);
              }
            });
          },
          {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
          }
        );

        document.querySelectorAll('.scroll-reveal').forEach((el) => {
          observer.observe(el);
        });
      };

      // Run on initial load
      initScrollReveal();

      // Re-run after Astro page transitions (View Transitions)
      document.addEventListener('astro:page-load', initScrollReveal);
    </script>
  </body>
</html>
