---
interface Props {
  data: {
    headline: {
      before: string;
      highlight: string;
    };
    subheadline: string;
    stages: Array<{
      time: string;
      title: string;
      description: string;
      deliverables: string[];
    }>;
    cta: {
      label: string;
      href: string;
    };
  };
}

const { data } = Astro.props;

// Icons for each stage
const stageIcons = [
  // Discovery - Search/Magnifying glass
  `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>`,
  // Strategy - Target/Compass
  `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>`,
  // Execution - Gears/Build
  `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>`,
  // Scale - Chart/Growth
  `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>`
];
---

<section id="steps" class="timeline-section" data-section="timeline">
  <div class="container">
    <!-- Header -->
    <div class="timeline-header">
      <h2 class="timeline-headline">
        {data.headline.before}<span class="text-accent">{data.headline.highlight}</span>
      </h2>
      <p class="timeline-subheadline">{data.subheadline}</p>
    </div>

    <!-- Horizontal Timeline -->
    <div class="timeline-wrapper scroll-reveal">
      <!-- Progress Line -->
      <div class="progress-line" aria-hidden="true">
        <div class="progress-line-fill"></div>
      </div>

      <!-- Stages -->
      <div class="stages-grid">
        {data.stages.map((stage, index) => (
          <div class={`stage scroll-reveal stagger-${index + 1}`}>
            <!-- Time marker -->
            <div class="stage-time">{stage.time}</div>

            <!-- Circle marker with icon -->
            <div class="stage-marker">
              <div class="marker-circle">
                <span class="marker-icon" set:html={stageIcons[index]} />
              </div>
            </div>

            <!-- Content card -->
            <div class="stage-card">
              <h3 class="stage-title">{stage.title}</h3>
              <p class="stage-description">{stage.description}</p>

              <!-- Deliverables -->
              <ul class="stage-deliverables">
                {stage.deliverables.map((deliverable) => (
                  <li class="deliverable-item">
                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <polyline points="20 6 9 17 4 12"/>
                    </svg>
                    {deliverable}
                  </li>
                ))}
              </ul>
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- CTA -->
    <div class="timeline-cta">
      <a
        href={data.cta.href}
        class="cta-button"
        target="_blank"
        rel="noopener noreferrer"
      >
        {data.cta.label}
        <svg class="cta-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>
  </div>
</section>

<style>
  .timeline-section {
    padding: var(--spacing-xl) 0;
    background-color: var(--color-background-primary);
  }

  @media (min-width: 768px) {
    .timeline-section {
      padding: var(--spacing-3xl) 0;
    }
  }

  .timeline-header {
    text-align: center;
    max-width: 700px;
    margin: 0 auto var(--spacing-xl);
  }

  @media (min-width: 768px) {
    .timeline-header {
      margin-bottom: var(--spacing-2xl);
    }
  }

  .timeline-headline {
    font-size: clamp(1.75rem, 5vw, 3rem);
    font-weight: 700;
    line-height: 1.15;
    margin-bottom: var(--spacing-sm);
  }

  .timeline-subheadline {
    font-size: var(--font-size-md);
    color: var(--color-text-secondary);
    line-height: 1.6;
  }

  @media (min-width: 768px) {
    .timeline-subheadline {
      font-size: var(--font-size-lg);
    }
  }

  .timeline-wrapper {
    position: relative;
    max-width: 1100px;
    margin: 0 auto;
  }

  /* Override scroll-reveal for wrapper - only use for triggering progress line */
  .timeline-wrapper.scroll-reveal {
    opacity: 1;
    transform: none;
  }

  /* Progress Line */
  .progress-line {
    display: none;
  }

  @media (min-width: 768px) {
    .progress-line {
      display: block;
      position: absolute;
      top: 80px;
      left: 12.5%;
      right: 12.5%;
      height: 4px;
      background-color: var(--color-background-secondary);
      border-radius: 2px;
    }

    .progress-line-fill {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 100%;
      background: linear-gradient(90deg, var(--color-accent) 0%, var(--color-accent) 100%);
      border-radius: 2px;
      transform-origin: left;
      transform: scaleX(0);
      transition: transform 1.2s ease-out 0.3s;
    }

    .timeline-wrapper.is-visible .progress-line-fill {
      transform: scaleX(1);
    }
  }

  /* Stages Grid */
  .stages-grid {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
  }

  @media (min-width: 768px) {
    .stages-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--spacing-sm);
    }
  }

  .stage {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: var(--spacing-sm);
  }

  @media (min-width: 768px) {
    .stage {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
  }

  /* Time marker */
  .stage-time {
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--color-accent);
    white-space: nowrap;
    min-width: 80px;
  }

  @media (min-width: 768px) {
    .stage-time {
      font-size: var(--font-size-base);
      min-width: auto;
      margin-bottom: var(--spacing-xs);
    }
  }

  /* Circle marker with icon */
  .stage-marker {
    display: none;
  }

  @media (min-width: 768px) {
    .stage-marker {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 1;
      margin-bottom: var(--spacing-sm);
    }

    .marker-circle {
      width: 36px;
      height: 36px;
      background-color: var(--color-background-primary);
      border-radius: 50%;
      border: 3px solid var(--color-accent);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .stage:hover .marker-circle {
      background-color: var(--color-accent);
    }

    .stage:hover .marker-icon {
      color: var(--color-background-primary);
    }

    .marker-icon {
      width: 18px;
      height: 18px;
      color: var(--color-accent);
      transition: color 0.3s ease;
    }

    .marker-icon :global(svg) {
      width: 100%;
      height: 100%;
    }

    .stage:nth-child(1) .marker-circle { animation: pulse 2s ease-in-out infinite 0s; }
    .stage:nth-child(2) .marker-circle { animation: pulse 2s ease-in-out infinite 0.5s; }
    .stage:nth-child(3) .marker-circle { animation: pulse 2s ease-in-out infinite 1s; }
    .stage:nth-child(4) .marker-circle { animation: pulse 2s ease-in-out infinite 1.5s; }
  }

  @keyframes pulse {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(203, 252, 1, 0.4);
    }
    50% {
      box-shadow: 0 0 0 8px rgba(203, 252, 1, 0);
    }
  }

  /* Content card */
  .stage-card {
    background-color: var(--color-background-secondary);
    border-radius: 0;
    padding: var(--spacing-sm);
    flex: 1;
    border: 1px solid var(--Border-tertiary, #444444);
    transition: transform 0.2s ease, border-color 0.2s ease;
  }

  .stage-card:hover {
    transform: translateY(-4px);
    border-color: var(--color-accent);
  }

  @media (min-width: 768px) {
    .stage-card {
      padding: var(--spacing-md);
      width: 100%;
    }
  }

  .stage-title {
    font-size: var(--font-size-lg);
    font-weight: 700;
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-xxs);
  }

  @media (min-width: 768px) {
    .stage-title {
      font-size: var(--font-size-xl);
      margin-bottom: var(--spacing-xs);
    }
  }

  .stage-description {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    line-height: 1.5;
    margin-bottom: var(--spacing-sm);
  }

  @media (min-width: 768px) {
    .stage-description {
      font-size: var(--font-size-base);
      min-height: 72px;
    }
  }

  /* Deliverables */
  .stage-deliverables {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xxs);
  }

  @media (min-width: 768px) {
    .stage-deliverables {
      text-align: left;
    }
  }

  .deliverable-item {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
    line-height: 1.4;
  }

  @media (min-width: 768px) {
    .deliverable-item {
      font-size: var(--font-size-sm);
    }
  }

  .check-icon {
    width: 14px;
    height: 14px;
    min-width: 14px;
    color: var(--color-accent);
    margin-top: 2px;
  }

  /* CTA */
  .timeline-cta {
    display: flex;
    justify-content: center;
    margin-top: var(--spacing-xl);
  }

  @media (min-width: 768px) {
    .timeline-cta {
      margin-top: var(--spacing-2xl);
    }
  }

  .cta-button {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 1.75rem;
    font-size: var(--font-size-base);
    font-weight: 600;
    color: var(--color-text-alternate);
    background-color: var(--color-accent);
    border-radius: var(--radius-full);
    transition: all 0.2s ease;
  }

  .cta-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(203, 252, 1, 0.3);
    color: var(--color-text-alternate);
  }

  .cta-arrow {
    width: 20px;
    height: 20px;
    transition: transform 0.2s ease;
  }

  .cta-button:hover .cta-arrow {
    transform: translateX(4px);
  }
</style>
